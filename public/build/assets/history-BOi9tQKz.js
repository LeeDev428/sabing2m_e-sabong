import{r as n,j as e,H as k,P as T,a as P}from"./app-BGyIldxf.js";import{T as R}from"./teller-layout-DeRNUDHW.js";import{H as L}from"./html5-qrcode-scanner-TDL5tudi.js";import{t as m}from"./thermalPrinter-BqqMY1sb.js";import{s as a}from"./toast-kz1Cz6CV.js";import"./app-CrPI8egW.js";function Q({bets:h,summary:l}){const[g,b]=n.useState("summary"),[v,s]=n.useState(!1),[u,i]=n.useState(!1),[j,f]=n.useState(!1),o=n.useRef(null),d=n.useRef(!1);n.useEffect(()=>{m.initialize().then(()=>{f(m.isConnected())});const t=r=>{f(r)};return m.addConnectionListener(t),()=>{m.removeConnectionListener(t)}},[]),n.useEffect(()=>()=>{o.current&&d.current&&o.current.stop().catch(t=>{console.log("Scanner cleanup:",t.message)})},[]);const N=async()=>{try{console.log("Starting void scanner..."),i(!0),await new Promise(c=>setTimeout(c,100));const t=await T.ensureCameraPermission();if(!t.granted){i(!1),a("‚ö†Ô∏è "+(t.error||"Camera permission denied"),"error",5e3);return}const r=new L("void-qr-reader");o.current=r,await r.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},c=>{console.log("üéØ QR Code scanned:",c),d.current=!1,r.stop(),i(!1),console.log("‚è∏Ô∏è Showing void confirmation dialog"),confirm(`Void ticket ${c}? This action cannot be undone.`)?(console.log("‚úÖ User confirmed void, sending request..."),P.post("/teller/bets/void",{ticket_id:c},{preserveScroll:!0,onSuccess:x=>{console.log("‚úÖ Void request successful:",x.props),s(!1),a("‚úÖ Ticket voided successfully!","success",3e3)},onError:x=>{console.error("‚ùå Void request failed:",x),s(!1);const C=typeof x=="object"?JSON.stringify(x):x;a(`‚ùå Failed to void: ${C}`,"error",5e3)}})):(console.log("‚ùå User cancelled void"),s(!1))},c=>{}),d.current=!0,console.log("‚úÖ Scanner started successfully")}catch(t){console.error("‚ùå Scanner failed to start:",t),a(`Scanner error: ${t.message||"Camera permission denied?"}`,"error",5e3),i(!1),s(!1),d.current=!1}},p=()=>{o.current&&d.current&&(d.current=!1,o.current.stop().then(()=>{i(!1),s(!1),o.current=null}).catch(t=>{console.log("Stop scanner error:",t.message),i(!1),s(!1)}))},y=async t=>{if(!j){a("‚ùå Printer not connected. Connect printer first.","error",3e3);return}try{await m.printTicket({ticket_id:t.ticket_id||`TKT-${t.id}`,fight_number:t.fight.fight_number,side:t.side,amount:t.amount,odds:t.odds||1.95,potential_payout:t.potential_payout,event_name:t.fight.event_name}),a("‚úÖ Receipt reprinted successfully!","success",2e3)}catch(r){console.error("Print error:",r),a(`‚ùå Print failed: ${r.message}`,"error",3e3)}},w=t=>{switch(t.toLowerCase()){case"meron":return"text-red-400";case"wala":return"text-blue-400";case"draw":return"text-green-400";default:return"text-gray-400"}},S=t=>{switch(t.toLowerCase()){case"won":return"bg-green-600";case"lost":return"bg-red-600";case"refunded":return"bg-yellow-600";default:return"bg-gray-600"}};return e.jsxs(R,{currentPage:"history",children:[e.jsx(k,{title:"History & Summary"}),e.jsxs("div",{className:"p-4 max-w-2xl mx-auto",children:[e.jsx("div",{className:"bg-[#1a1a1a] rounded-lg p-4 mb-4 border border-gray-700",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-orange-500",children:"History & Summary"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Transaction logs and betting summary"})]}),e.jsxs("button",{onClick:()=>s(!0),className:"bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold flex items-center gap-2",children:[e.jsx("span",{children:"‚ùå"})," Void Ticket"]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-4",children:[e.jsx("button",{onClick:()=>b("summary"),className:`py-3 rounded-lg font-semibold transition-colors ${g==="summary"?"bg-blue-600 text-white":"bg-[#1a1a1a] text-gray-400 hover:text-white"}`,children:"üìä Summary"}),e.jsx("button",{onClick:()=>b("bets"),className:`py-3 rounded-lg font-semibold transition-colors ${g==="bets"?"bg-blue-600 text-white":"bg-[#1a1a1a] text-gray-400 hover:text-white"}`,children:"üé∞ Bets"})]}),g==="summary"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-900/50 to-purple-900/50 rounded-lg p-6 border border-blue-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-300 mb-2",children:"Total Bets Today"}),e.jsx("div",{className:"text-4xl font-bold text-white",children:l.total_bets})]})}),e.jsx("div",{className:"bg-[#1a1a1a] rounded-lg p-6 border border-gray-700",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-400 mb-2",children:"Total Bet Amount"}),e.jsxs("div",{className:"text-3xl font-bold text-yellow-400",children:["‚Ç±",l.total_amount.toLocaleString()]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"bg-green-900/30 rounded-lg p-4 border border-green-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-green-300 mb-1",children:"Won Bets"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.won_bets})]})}),e.jsx("div",{className:"bg-red-900/30 rounded-lg p-4 border border-red-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-red-300 mb-1",children:"Lost Bets"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.lost_bets})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("div",{className:"bg-blue-900/30 rounded-lg p-4 border border-blue-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-blue-300 mb-1",children:"Claimed"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.claimed_bets})]})}),e.jsx("div",{className:"bg-purple-900/30 rounded-lg p-4 border border-purple-500/30",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-purple-300 mb-1",children:"Voided"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.voided_bets})]})})]})]}),g==="bets"&&e.jsx("div",{className:"space-y-3",children:h.data.length===0?e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-8 text-center border border-gray-700",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üé∞"}),e.jsx("p",{className:"text-gray-400",children:"No bets yet"})]}):h.data.map(t=>e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 border border-gray-700",children:[t.fight.event_name&&e.jsx("div",{className:"text-center mb-3 pb-2 border-b border-gray-700",children:e.jsx("div",{className:"text-lg font-bold bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 bg-clip-text text-transparent",children:t.fight.event_name})}),e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Fight #",t.fight.fight_number]}),e.jsxs("div",{className:"text-lg font-bold",children:[t.fight.meron_fighter," vs ",t.fight.wala_fighter]})]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-bold ${S(t.status)}`,children:t.status.toUpperCase()})]}),t.status==="active"&&e.jsxs("button",{onClick:()=>y(t),className:"w-full mt-3 bg-purple-600 hover:bg-purple-700 py-2 rounded-lg font-semibold text-sm flex items-center justify-center gap-2",children:[e.jsx("span",{children:"üñ®Ô∏è"})," PRINT"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Bet Side"}),e.jsx("div",{className:`text-lg font-bold ${w(t.side)}`,children:t.side.toUpperCase()})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-gray-400",children:"Amount"}),e.jsxs("div",{className:"text-lg font-bold text-white",children:["‚Ç±",t.amount.toLocaleString()]})]})]}),t.status==="won"&&e.jsxs("div",{className:"bg-green-900/30 rounded-lg p-3 border border-green-500/30",children:[e.jsx("div",{className:"text-xs text-green-300 mb-1",children:"Payout"}),e.jsxs("div",{className:"text-2xl font-bold text-green-400",children:["‚Ç±",t.actual_payout?.toLocaleString()]})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-2",children:new Date(t.created_at).toLocaleString()})]},t.id))})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-[#1a2332] rounded-lg w-full max-w-md border-2 border-red-500",children:[e.jsxs("div",{className:"bg-red-600 px-6 py-3 flex justify-between items-center rounded-t-lg",children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx("span",{children:"‚ùå"})," Void Ticket"]}),e.jsx("button",{onClick:()=>{p(),s(!1)},className:"text-white hover:text-gray-200 text-3xl leading-none",children:"√ó"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{id:"void-qr-reader",className:`rounded-lg overflow-hidden mb-4 ${u?"":"hidden"}`}),!u&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì∑"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Scan QR code to void ticket"}),e.jsx("p",{className:"text-sm text-red-400 mb-2",children:"‚ö†Ô∏è This action cannot be undone"}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:'üëá Click "Start Scanner" below to scan the QR code on the printed receipt'}),e.jsx("button",{onClick:N,className:"bg-red-600 hover:bg-red-700 px-8 py-3 rounded-lg font-bold mb-3",children:"Start Scanner"})]}),u&&e.jsx("button",{onClick:p,className:"w-full bg-gray-600 hover:bg-gray-700 py-3 rounded-lg font-bold",children:"Cancel"})]})]})})]})}export{Q as default};
