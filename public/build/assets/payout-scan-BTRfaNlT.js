import{r as l,j as e,H as S,a as u,P as C}from"./app-BhlJV8j8.js";import{T as P}from"./teller-layout-Br2dWl7y.js";import{H as R}from"./html5-qrcode-scanner-IJ4FL-tL.js";import{s as n}from"./toast-kz1Cz6CV.js";import{t as b}from"./thermalPrinter-BUh7MOpR.js";import"./app-oKtDJvqm.js";function U({message:i,claimData:s}){const[g,c]=l.useState(!1),[A,p]=l.useState(null),[f,h]=l.useState(null),[a,j]=l.useState(!1),d=l.useRef(null),o=l.useRef(!1);l.useEffect(()=>{b.initialize().then(()=>{j(b.isConnected())});const t=r=>{j(r)};return b.addConnectionListener(t),()=>{b.removeConnectionListener(t)}},[]),l.useEffect(()=>{(async()=>{if(s&&!s.already_claimed&&a)try{s.is_refund?await y():await N()}catch(r){console.error("Auto-print failed:",r)}})()},[s,a]),l.useEffect(()=>()=>{d.current&&o.current&&d.current.stop().catch(t=>{console.log("Scanner cleanup:",t.message)})},[]);const N=async()=>{if(!a){n("âŒ Printer not connected","error",3e3);return}if(!s){n("âŒ No claim data available","error",3e3);return}try{const t=s.bet_amount??s.amount??0,r=s.odds??1;await b.printPayoutReceipt({ticket_id:s.ticket_id||"N/A",fight_number:s.fight_number||0,side:s.side||"N/A",bet_amount:Number(t),odds:Number(r),payout_amount:Number(s.amount),bet_by:s.bet_by,claimed_by:s.claimed_by,event_name:s.event_name}),n("âœ… Payout receipt printed!","success",2e3)}catch(t){console.error("Print error:",t),n(`âŒ Print failed: ${t.message}`,"error",3e3)}},y=async()=>{if(!a){n("âŒ Printer not connected","error",3e3);return}if(!s){n("âŒ No claim data available","error",3e3);return}try{await b.printRefundReceipt({ticket_id:s.ticket_id||"N/A",fight_number:s.fight_number||0,side:s.side||"N/A",bet_amount:s.bet_amount||0,refund_amount:s.amount,bet_by:s.bet_by,claimed_by:s.claimed_by,event_name:s.event_name,refund_reason:s.refund_reason||"DRAW"}),n("âœ… Refund receipt printed!","success",2e3)}catch(t){console.error("Print error:",t),n(`âŒ Print failed: ${t.message}`,"error",3e3)}},v=async()=>{try{h(null),p(null),c(!0),await new Promise(x=>setTimeout(x,100));const t=await C.ensureCameraPermission();if(!t.granted){h(t.error||"Camera permission denied"),c(!1),n("âš ï¸ "+(t.error||"Camera permission denied"),"error",5e3);return}const r=new R("qr-reader");d.current=r,await r.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},x=>{console.log("ðŸŽ¯ Payout QR Code scanned:",x),p(x),o.current=!1,r.stop(),c(!1),console.log("ðŸ’° Sending payout claim request..."),u.post("/teller/payout-scan/claim",{ticket_id:x},{preserveScroll:!1,onSuccess:m=>{console.log("âœ… Payout claim successful:",m.props)},onError:m=>{console.error("âŒ Payout claim failed:",m);const w=typeof m=="object"?JSON.stringify(m):String(m);h(w),n(`âŒ Failed to claim: ${w}`,"error",5e3)}})},x=>{}),o.current=!0,console.log("âœ… Payout scanner started successfully")}catch(t){console.error("âŒ Payout scanner failed to start:",t);const r=t.message||"Failed to start camera";h(r),c(!1),o.current=!1,n(`âš ï¸ Camera error: ${r}`,"error",5e3)}},_=()=>{d.current&&o.current&&(o.current=!1,d.current.stop().then(()=>{c(!1),d.current=null}).catch(t=>{console.log("Stop scanner error:",t.message),c(!1)}))};return e.jsxs(P,{currentPage:"payout",children:[e.jsx(S,{title:"Payout Scanning"}),e.jsxs("div",{className:"p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 mb-4 border border-gray-700",children:[e.jsx("h1",{className:"text-2xl font-bold text-orange-500 mb-1",children:"Payout Scanning"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Scan QR code on bet ticket to claim winnings"})]}),!s&&!i&&e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 mb-4 border border-gray-700",children:[e.jsx("div",{id:"qr-reader",className:`rounded-lg overflow-hidden ${g?"":"hidden"}`}),!g&&!f&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“·"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Ready to scan QR code"}),e.jsx("button",{onClick:v,className:"bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-bold",children:"Start Camera"})]}),f&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âš ï¸"}),e.jsx("p",{className:"text-red-400 mb-4",children:f}),e.jsx("button",{onClick:v,className:"bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-bold",children:"Try Again"})]}),g&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:_,className:"bg-red-600 hover:bg-red-700 px-8 py-3 rounded-lg font-bold",children:"Stop Scanning"})})]}),s&&!s.already_claimed&&!s.is_refund&&e.jsxs("div",{className:"bg-green-900/30 border-2 border-green-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âœ…"}),e.jsx("h2",{className:"text-3xl font-bold text-green-400 mb-2",children:"Success!"}),e.jsx("p",{className:"text-white text-xl",children:"Claimed Successfully"})]}),e.jsxs("div",{className:"space-y-3 bg-[#1a1a1a] rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Fight#:"}),e.jsx("span",{className:"text-white font-semibold",children:s.fight_number||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Teller:"}),e.jsx("span",{className:"text-white font-semibold",children:s.bet_by})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Receipt:"}),e.jsx("span",{className:"text-white font-semibold text-xs",children:s.ticket_id||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Date:"}),e.jsx("span",{className:"text-white font-semibold",children:new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Time:"}),e.jsx("span",{className:"text-white font-semibold",children:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]}),e.jsx("div",{className:"border-t-2 border-gray-700 my-2"}),e.jsx("div",{className:"text-center py-4",children:e.jsxs("div",{className:"text-4xl font-bold text-yellow-400",children:[(s.side||"N/A").toUpperCase()," - â‚±",s.amount.toLocaleString()]})}),e.jsx("div",{className:"border-t-2 border-gray-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Claimed By:"}),e.jsx("span",{className:"text-white font-semibold",children:s.claimed_by})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-green-400 font-bold",children:s.status})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("div",{className:"text-sm font-bold text-gray-400",children:"OFFICIAL BETTING RECEIPT"})})]}),e.jsxs("button",{onClick:N,disabled:!a,className:`w-full mt-6 py-3 rounded-lg font-bold flex items-center justify-center gap-2 ${a?"bg-purple-600 hover:bg-purple-700":"bg-gray-600 cursor-not-allowed opacity-50"}`,children:[e.jsx("span",{children:"ðŸ–¨ï¸"})," Print Payout Receipt"]}),e.jsx("button",{onClick:()=>u.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),s&&!s.already_claimed&&s.is_refund&&e.jsxs("div",{className:"bg-orange-900/30 border-2 border-orange-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-7xl mb-4",children:"ðŸ’°"}),e.jsx("h2",{className:"text-3xl font-bold text-orange-400 mb-2",children:"Refund Processed!"}),e.jsxs("p",{className:"text-white text-xl",children:["Fight ",s.refund_reason||"DRAW"," â€” Full Refund"]})]}),e.jsxs("div",{className:"space-y-3 bg-[#1a1a1a] rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Fight#:"}),e.jsx("span",{className:"text-white font-semibold",children:s.fight_number||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Teller:"}),e.jsx("span",{className:"text-white font-semibold",children:s.bet_by})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Receipt:"}),e.jsx("span",{className:"text-white font-semibold text-xs",children:s.ticket_id||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Reason:"}),e.jsx("span",{className:"text-orange-400 font-bold",children:s.refund_reason||"DRAW"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Date:"}),e.jsx("span",{className:"text-white font-semibold",children:new Date().toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"})})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Time:"}),e.jsx("span",{className:"text-white font-semibold",children:new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})})]}),e.jsx("div",{className:"border-t-2 border-gray-700 my-2"}),e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"text-lg text-gray-400 mb-1",children:"REFUND AMOUNT"}),e.jsxs("div",{className:"text-4xl font-bold text-orange-400",children:["â‚±",s.amount.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-gray-400 mt-1",children:["(",(s.side||"N/A").toUpperCase()," â€” Bet: â‚±",(s.bet_amount||0).toLocaleString(),")"]})]}),e.jsx("div",{className:"border-t-2 border-gray-700 my-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Refunded By:"}),e.jsx("span",{className:"text-white font-semibold",children:s.claimed_by})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-orange-400 font-bold",children:s.status})]}),e.jsx("div",{className:"text-center pt-2",children:e.jsx("div",{className:"text-sm font-bold text-gray-400",children:"OFFICIAL REFUND RECEIPT"})})]}),e.jsxs("button",{onClick:y,disabled:!a,className:`w-full mt-6 py-3 rounded-lg font-bold flex items-center justify-center gap-2 ${a?"bg-purple-600 hover:bg-purple-700":"bg-gray-600 cursor-not-allowed opacity-50"}`,children:[e.jsx("span",{children:"ðŸ–¨ï¸"})," Print Refund Receipt"]}),e.jsx("button",{onClick:()=>u.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),s&&s.already_claimed&&e.jsxs("div",{className:"bg-yellow-900/30 border-2 border-yellow-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-3xl font-bold text-yellow-400 mb-2",children:"Already Claimed!"}),e.jsx("p",{className:"text-white",children:"This ticket has already been redeemed"})]}),e.jsx("button",{onClick:()=>u.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),i&&i.includes("Lost")&&e.jsxs("div",{className:"bg-red-900/30 border-2 border-red-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âŒ"}),e.jsx("h2",{className:"text-3xl font-bold text-red-400 mb-2",children:"Cannot Claim"}),e.jsx("p",{className:"text-white text-xl",children:i})]}),e.jsx("button",{onClick:()=>u.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),i&&!i.includes("Lost")&&!s&&e.jsxs("div",{className:"bg-red-900/30 border-2 border-red-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-2",children:"Error"}),e.jsx("p",{className:"text-white",children:i})]}),e.jsx("button",{onClick:()=>u.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Try Again"})]}),e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"ðŸ“‹ Instructions"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"1."}),e.jsx("span",{children:'Click "Start Camera" to activate the QR scanner'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"2."}),e.jsx("span",{children:"Position the bet ticket QR code within the camera view"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"3."}),e.jsx("span",{children:"Wait for automatic detection and claim validation"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"4."}),e.jsx("span",{children:"View claim status and payout amount"})]})]})]})]})]})}export{U as default};
