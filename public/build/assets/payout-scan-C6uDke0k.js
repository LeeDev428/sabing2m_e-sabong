import{r as d,j as e,H as N,a as x,P as y}from"./app-BPo8oLRF.js";import{T as v}from"./teller-layout-BGNdvWId.js";import{H as w}from"./html5-qrcode-scanner-C48NxLoX.js";import{s as h}from"./toast-kz1Cz6CV.js";import"./app-B5WdmQbP.js";function A({message:r,claimData:s}){const[u,l]=d.useState(!1),[S,g]=d.useState(null),[b,m]=d.useState(null),a=d.useRef(null),n=d.useRef(!1);d.useEffect(()=>()=>{a.current&&n.current&&a.current.stop().catch(t=>{console.log("Scanner cleanup:",t.message)})},[]);const p=async()=>{try{m(null),g(null),l(!0),await new Promise(o=>setTimeout(o,100));const t=await y.ensureCameraPermission();if(!t.granted){m(t.error||"Camera permission denied"),l(!1),h("âš ï¸ "+(t.error||"Camera permission denied"),"error",5e3);return}const c=new w("qr-reader");a.current=c,await c.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},o=>{console.log("ðŸŽ¯ Payout QR Code scanned:",o),g(o),n.current=!1,c.stop(),l(!1),console.log("ðŸ’° Sending payout claim request..."),x.post("/teller/payout-scan/claim",{ticket_id:o},{preserveScroll:!1,onSuccess:i=>{console.log("âœ… Payout claim successful:",i.props)},onError:i=>{console.error("âŒ Payout claim failed:",i);const j=typeof i=="object"?JSON.stringify(i):String(i);m(j),h(`âŒ Failed to claim: ${j}`,"error",5e3)}})},o=>{}),n.current=!0,console.log("âœ… Payout scanner started successfully")}catch(t){console.error("âŒ Payout scanner failed to start:",t);const c=t.message||"Failed to start camera";m(c),l(!1),n.current=!1,h(`âš ï¸ Camera error: ${c}`,"error",5e3)}},f=()=>{a.current&&n.current&&(n.current=!1,a.current.stop().then(()=>{l(!1),a.current=null}).catch(t=>{console.log("Stop scanner error:",t.message),l(!1)}))};return e.jsxs(v,{currentPage:"payout",children:[e.jsx(N,{title:"Payout Scanning"}),e.jsxs("div",{className:"p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 mb-4 border border-gray-700",children:[e.jsx("h1",{className:"text-2xl font-bold text-orange-500 mb-1",children:"Payout Scanning"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Scan QR code on bet ticket to claim winnings"})]}),!s&&!r&&e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 mb-4 border border-gray-700",children:[e.jsx("div",{id:"qr-reader",className:`rounded-lg overflow-hidden ${u?"":"hidden"}`}),!u&&!b&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ“·"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Ready to scan QR code"}),e.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-bold",children:"Start Camera"})]}),b&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"âš ï¸"}),e.jsx("p",{className:"text-red-400 mb-4",children:b}),e.jsx("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-700 px-8 py-3 rounded-lg font-bold",children:"Try Again"})]}),u&&e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:f,className:"bg-red-600 hover:bg-red-700 px-8 py-3 rounded-lg font-bold",children:"Stop Scanning"})})]}),s&&!s.already_claimed&&e.jsxs("div",{className:"bg-green-900/30 border-2 border-green-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âœ…"}),e.jsx("h2",{className:"text-3xl font-bold text-green-400 mb-2",children:"Success!"}),e.jsx("p",{className:"text-white text-xl",children:"Claimed Successfully"})]}),e.jsxs("div",{className:"space-y-4 bg-[#1a1a1a] rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Claimed Amount:"}),e.jsxs("span",{className:"text-3xl font-bold text-yellow-400",children:["â‚±",s.amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between items-center border-t border-gray-700 pt-4",children:[e.jsx("span",{className:"text-gray-400",children:"Bet By:"}),e.jsx("span",{className:"text-white font-semibold",children:s.bet_by})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Claimed By:"}),e.jsx("span",{className:"text-white font-semibold",children:s.claimed_by})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-400",children:"Status:"}),e.jsx("span",{className:"text-green-400 font-bold",children:s.status})]})]}),e.jsx("button",{onClick:()=>x.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),s&&s.already_claimed&&e.jsxs("div",{className:"bg-yellow-900/30 border-2 border-yellow-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-3xl font-bold text-yellow-400 mb-2",children:"Already Claimed!"}),e.jsx("p",{className:"text-white",children:"This ticket has already been redeemed"})]}),e.jsx("button",{onClick:()=>x.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),r&&r.includes("Lost")&&e.jsxs("div",{className:"bg-red-900/30 border-2 border-red-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âŒ"}),e.jsx("h2",{className:"text-3xl font-bold text-red-400 mb-2",children:"Cannot Claim"}),e.jsx("p",{className:"text-white text-xl",children:r})]}),e.jsx("button",{onClick:()=>x.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Scan Another"})]}),r&&!r.includes("Lost")&&!s&&e.jsxs("div",{className:"bg-red-900/30 border-2 border-red-500 rounded-lg p-6 mb-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-7xl mb-4",children:"âš ï¸"}),e.jsx("h2",{className:"text-2xl font-bold text-red-400 mb-2",children:"Error"}),e.jsx("p",{className:"text-white",children:r})]}),e.jsx("button",{onClick:()=>x.visit("/teller/payout-scan"),className:"w-full mt-6 bg-blue-600 hover:bg-blue-700 py-3 rounded-lg font-bold",children:"Try Again"})]}),e.jsxs("div",{className:"bg-[#1a1a1a] rounded-lg p-4 border border-gray-700",children:[e.jsx("h3",{className:"font-bold text-lg mb-2",children:"ðŸ“‹ Instructions"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"1."}),e.jsx("span",{children:'Click "Start Camera" to activate the QR scanner'})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"2."}),e.jsx("span",{children:"Position the bet ticket QR code within the camera view"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"3."}),e.jsx("span",{children:"Wait for automatic detection and claim validation"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-400",children:"4."}),e.jsx("span",{children:"View claim status and payout amount"})]})]})]})]})]})}export{A as default};
